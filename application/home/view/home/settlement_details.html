<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1.0,user-scalable=no">
<title>结算明细</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="{:config('home_css')}weui.min.css">
<link rel="stylesheet" href="{:config('home_css')}jquery-weui.min.css">
<link rel="stylesheet" href="{:config('home_css')}public.css">
<link rel="stylesheet" href="{:config('home_css')}styles.css">
<link rel="stylesheet" href="{:config('home_css')}details.css">
</head>
<body class="details_color">
    <!-- 加载提示层 -->
    <div class="weui-loadmore weuiloadmore_bodys">
       <i class="weui-loading weuiloading_img"></i> 
    </div>

    <div class="container">
      <header class="public_header">
      	  <div class="public_left">
      	  	<a href="javascript:history.back();">
      	  	   <img src="{:config('home_images')}nav_icon_back.png" class="nav_back">
      	  	   <span class="header_back">返回</span>
      	    </a>	
      	  </div>
      	  <div class="public_center">
      	  	<h5 class="register_h5title">结算明细</h5>
      	  </div>
      </header>
      <div class="settlement_details">
          <div id="settlement_details"></div>
      	  <div class="weui-infinite-scroll">
                <div class="infinite-preloader"></div>
                <p class="order_more_data">正在加载...</p>
          </div>
      	
      </div> 
    </div>
    <script src="{:config('home_js')}jquery-3.0.0.min.js"></script>
    <script src="{:config('home_js')}jquery-weui.min.js"></script>
    <script src="{:config('home_js')}public.js"></script>
    <script>
       $(function(){
          var page=1; //当前页
          var pagesize=20; //当前每页显示得条数
          
          settlement_ajax(page); //默认加载接口方法
          function settlement_ajax(page){
             $.ajax({
                url:"/api/v1/reception/OrderDetailed/"+page+"/"+pagesize,
                dataType:"json",
                type:"get",
                success:function(res){
                   $(".weui-loadmore").hide();
                   var datetime=res.data;
                   if(res.data.length<="0" || res.data=="没有数据"){
                     $(".order_more_data").show();
                     $(".order_more_data").text("暂无数据");
                     $(document.body).destroyInfinite();
                   }else if(res.data.length<pagesize){
                     settlement_details(datetime);
                     $(".order_more_data").text("没有数据了");
                     $(document.body).destroyInfinite(); 
                   }else{
                     settlement_details(datetime);
                   } 
                },
                error:function(error){
                   $(document.body).destroyInfinite();
                   console.log(error);
                   $.toast("抱歉,出错了","text");
                }
             })

          } 

        
          /* js字符拼接方法 */
          function settlement_details(data){
                var html='';
                for(var i=0;i<data.length;i++){
                    html+='<div class="weui-cell settlement_cell">';
                    html+='<div class="weui-cell_bd settlement_cell_con">';
                    html+='<p class="settlement_cell_order">订单号：<span>'+data[i].order_number+'</span></p>';
                    html+='<p class="settlement_cell_money">结算金额：<span>'+data[i].estimate_price+'</span></p>';
                    html+='</div>';
                    html+='<div class="weui-cell_ft">';
                    html+='<p class="settlement_cell_time">'+data[i].create_time+'</p>';
                    html+='<p class="settlement_addmoney d_right">+'+data[i].actual_price+'</p>';
                    html+='</div>';
                    html+='</div>';
                }
                $("#settlement_details").append(html);
          }


          var loading =false ;  
          $(document.body).infinite().on("infinite", function() {
            if(loading) return;
            loading = true;
            setTimeout(function() {
              $(".order_more_data").show();
              page=page+1;
              settlement_ajax(page);
              loading = false;
            }, 10);   
          });

       })

    </script>  
</body>
</html>